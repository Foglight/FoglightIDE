<?xml version="1.0" encoding="UTF-8"?>
<module xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="3-015" display-name="TopologyExports" last-entity-id="5" parent="system:development_export_cieditors">
    <view id="1" display-name="ServicesDropdown" ts="1276983150678" public="false" component="wcf.table.tree-table">
        <uuid>9796a121-b704-4514-8132-2bf8fd354ea5</uuid>
        <size width="300" height="300"/>
        <inputs>
            <entry key="selectedService" data-type="foglight-5:FSMService" usage="optional" implicit="true"/>
        </inputs>
        <flow>
            <on action="nodeSelection">
                <generated-context output-key="selectedNode" custom-key="selectedService"/>
                <update/>
            </on>
        </flow>
        <tree-config>
            <property name="root">
                <query-selection-rv query="system:foglight_services.10"/>
            </property>
            <property name="displayType">
                <data-object-type datasource-type="foglight-5" data-type="FSMService"/>
            </property>
            <property name="dataTypeChildren">
                <list-item>
                    <property name="type">
                        <data-object-type datasource-type="foglight-5" data-type="FSMService"/>
                    </property>
                    <property name="explicitChildren">
                        <context-rv input-key="explicitChildrenCurrentNode" path="definition"/>
                    </property>
                </list-item>
            </property>
            <property name="columns">
                <list-item>
                    <property name="value">
                        <context-rv input-key="currentNode" path="name"/>
                    </property>
                    <property name="id">
                        <string xml:space="preserve"><![CDATA[c_0]]></string>
                    </property>
                </list-item>
            </property>
            <property name="dropDownModeConfiguration">
                <property name="dropDownModeEnabled">
                    <boolean value="true"/>
                </property>
                <property name="selectedItemLabel">
                    <function-rv id="system:development_export_cieditors_topologyexports.3">
                        <context-rv input-key="currentSelectedRow"/>
                    </function-rv>
                </property>
            </property>
        </tree-config>
    </view>
    <composite-view id="2" display-name="Service Structure_inner" ts="1276983658718" public="false" priority="p3" component="wcf.grid2">
        <uuid>8a9dc223-2100-41ae-a025-7e4de2781db9</uuid>
        <purpose name="pagelet"/>
        <size width="640" height="480"/>
        <inputs>
            <entry key="selectedService" data-type="foglight-5:FSMService"/>
            <entry key="includeContainments" data-type="wcf:Boolean"/>
        </inputs>
        <flow/>
        <tree-config/>
        <window id="0" view="nested">
            <size width="100"/>
            <tree-config>
                <property name="align">
                    <enum value="right"/>
                </property>
            </tree-config>
            <view id="nested" display-name="nvServiceLabel" ts="1276981034992" public="false" component="wcf.label">
                <size width="200" height="20"/>
                <flow/>
                <tree-config>
                    <property name="label">
                        <string xml:space="preserve"><![CDATA[Service :]]></string>
                    </property>
                </tree-config>
            </view>
        </window>
        <window id="1" view="system:development_export_cieditors_topologyexports.1">
            <size height="50"/>
            <tree-config>
                <property name="column">
                    <integer value="1"/>
                </property>
                <property name="align">
                    <enum value="stretch"/>
                </property>
                <property name="hweight">
                    <integer value="1"/>
                </property>
            </tree-config>
        </window>
        <window id="2" view="nested">
            <size/>
            <tree-config>
                <property name="row">
                    <integer value="1"/>
                </property>
            </tree-config>
            <view id="nested" display-name="nvLabelContainments" ts="1276982867002" public="false" component="wcf.label">
                <size width="200" height="20"/>
                <flow/>
                <tree-config>
                    <property name="label">
                        <string xml:space="preserve"><![CDATA[Include Containments :]]></string>
                    </property>
                </tree-config>
            </view>
        </window>
        <window id="3" view="nested">
            <size/>
            <tree-config>
                <property name="column">
                    <integer value="1"/>
                </property>
                <property name="row">
                    <integer value="1"/>
                </property>
            </tree-config>
            <view id="nested" display-name="nvComboContainments" ts="1276982964020" public="false" component="wcf.input.checkbox">
                <size width="20" height="20"/>
                <inputs>
                    <entry key="includeContainments" data-type="wcf:Boolean" usage="optional" implicit="true"/>
                </inputs>
                <generated-context output-key="value" custom-key="includeContainments"/>
                <flow>
                    <on action="update">
                        <update/>
                    </on>
                </flow>
                <tree-config/>
            </view>
        </window>
    </composite-view>
    <view id="4" display-name="Service Structure" ts="1277389522143" priority="p3" component="wcf.form">
        <uuid>4aa37fd6-8364-42dd-9c0f-8aae97391704</uuid>
        <purpose name="dialog"/>
        <purpose name="dataView"/>
        <custom-purpose name="CISelector"/>
        <size width="640" height="480"/>
        <inputs>
            <entry key="car" data-type="foglight-5:IDE_CAR_ExportContainer"/>
            <entry key="selectedService" data-type="foglight-5:FSMService" usage="internal">
                <null-rv/>
            </entry>
            <entry key="includeContainments" data-type="wcf:Boolean" usage="internal">
                <boolean value="true"/>
            </entry>
        </inputs>
        <flow/>
        <tree-config>
            <property name="view">
                <view-ref value="system:development_export_cieditors_topologyexports.2"/>
            </property>
            <property name="actions">
                <list-item>
                    <property name="text">
                        <string xml:space="preserve"><![CDATA[Add to Cartridge]]></string>
                    </property>
                    <property name="reaction">
                        <previous update="context">
                            <context>
                                <entry key="car">
                                    <function-rv id="system:development_export_cieditors_topologyexports.5">
                                        <context-rv input-key="car"/>
                                        <context-rv input-key="selectedService"/>
                                        <context-rv input-key="includeContainments"/>
                                    </function-rv>
                                </entry>
                            </context>
                        </previous>
                    </property>
                </list-item>
            </property>
            <property name="popupOptions">
                <property name="usePreferredWidth">
                    <boolean value="true"/>
                </property>
                <property name="usePreferredHeight">
                    <boolean value="true"/>
                </property>
            </property>
        </tree-config>
    </view>
    <script-function id="3" display-name="fullServicePath" ts="1276982738694" public="false" output-type="wcf:Object" cache-results="true">
        <uuid>e1a94542-433c-4497-abdc-975cdaea3779</uuid>
        <inputs>
            <input name="svc" type-name="foglight-5:FSMService"/>
        </inputs>
        <script xml:space="preserve"><![CDATA[def path = svc.parents
path.add(svc)
path.remove(0)

String p = ""
def b = false
path.each{ 
if (!b) b = true 
else p+="/"
p+=it.name
}

return p]]></script>
    </script-function>
    <script-function id="5" display-name="addToCartridge" ts="1277383697015" public="false" output-type="foglight-5:IDE_CAR_ExportContainer">
        <uuid>17e55b01-c0a7-4deb-8e68-0fe19fed961f</uuid>
        <inputs>
            <input name="car" type-name="foglight-5:IDE_CAR_ExportContainer"/>
            <input name="service" type-name="foglight-5:FSMService"/>
            <input name="includeContainments" type-name="wcf:Boolean"/>
        </inputs>
        <script xml:space="preserve"><![CDATA[def addElement(def groupname) {
    def gType = server.TopologyService.getType("IDE_Delegated_Group")

    def group =  server.TopologyService.getObjectShell(gType)
    group.set("container",car)
    group.set("name",groupname)

def createCar = { name ->
    def type = server.TopologyService.getType("IDE_CAR_ExportContainer")
    def obj = server.TopologyService.getObjectShell(type)
    obj.set("name",name)
return obj
}

def carCopy = createCar.call(car.get("name"))
carCopy.getList("definitionGroups").add(group)    

  

     
      def e = server.TopologyService.getObjectShell(server.TopologyService.getType("IDE_CI_ExpTypes"))
       e.set("service", service)
       e.set("includeContainments",includeContainments)     

e.set("parent",group)
e.set("ci_id",service.get("name"))
   group.getList("includes").add(e)

    
    server.TopologyService.mergeData([group,e,carCopy].flatten())

}

addElement ("DataExport")
return car
]]></script>
    </script-function>
</module>

